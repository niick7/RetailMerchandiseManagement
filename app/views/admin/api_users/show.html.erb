<h2 class="text-xl font-bold mb-4">
  API User Detail â€“ <%= @user.email %>
</h2>

<div class="space-y-2 text-sm">
  <div>
    <strong>Active:</strong> 
    <% if @user.active? %>
      <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-weight">Yes</span>
    <% else %>
      <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-weight">No</span>
    <% end %>
  </div>
</div>

<hr class="my-4">

<% if @user.api_user.present? %>
  <% api_user = @user.api_user %>
  <div class="max-w-xl space-y-6">
    <div class="bg-white rounded-xl shadow p-6 space-y-5">
      <div>
        <div class="text-sm font-medium text-gray-700 mb-1">API Token</div>
        <div class="flex items-center bg-gray-100 border border-gray-300 rounded-lg px-3 py-2">
          <div id="api-token" class="flex-1 font-mono text-xs sm:text-sm text-gray-800 break-all">
            <%= api_user.api_token %>
          </div>
          <button
            id="copy-token-btn"
            type="button"
            class="ml-3 px-2 py-1 text-xs bg-indigo-600 text-white rounded-md hover:bg-indigo-700 active:scale-95"
            data-token="<%= api_user.api_token %>"
          >
            Copy
          </button>
        </div>
      </div>
      <div class="flex items-center justify-between">
        <div class="text-sm font-medium text-gray-700">Token Expires At</div>
        <% expired = api_user.api_token_expired_at < Time.current %>
        <div class="<%= expired ? 'text-red-600 bg-red-50 border border-red-200' : 'text-green-700 bg-green-50 border border-green-200' %> text-xs px-3 py-1 rounded-lg ml-4">
          <%= api_user.api_token_expired_at %>
        </div>
      </div>
      <div class="flex items-center justify-between">
        <div class="text-sm font-medium text-gray-700">API Quota</div>
        <% quota = api_user.api_quota.to_i %>
        <% quota_class =
            if quota == 0
              "bg-red-100 text-red-700 border border-red-300"
            elsif quota < 50
              "bg-yellow-100 text-yellow-700 border border-yellow-300"
            else
              "bg-blue-100 text-blue-700 border border-blue-300"
            end
        %>
        <div class="text-xs font-semibold px-3 py-1 rounded-lg ml-4 <%= quota_class %>">
          <%= quota %>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <p class="text-gray-500 text-sm">No API settings configured.</p>
<% end %>

<div class="mt-6 flex gap-3">
  <%= link_to "Edit",
        edit_admin_api_user_path(@user),
        class: "bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded" %>

  <%= link_to "Back to list", admin_api_users_path,
            class: "px-3 py-1.5 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("copy-token-btn");
    if (!btn) return;

    btn.addEventListener("click", () => {
      const token = btn.dataset.token;

      navigator.clipboard.writeText(token).then(() => {
        btn.textContent = "Copied!";
        btn.classList.add("bg-green-600");
        btn.classList.remove("bg-indigo-600");

        setTimeout(() => {
          btn.textContent = "Copy";
          btn.classList.remove("bg-green-600");
          btn.classList.add("bg-indigo-600");
        }, 4000);
      });
    });
  });
</script>